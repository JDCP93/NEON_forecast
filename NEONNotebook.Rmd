---
title: "NEON Notebook"
output: html_notebook
---

This notebook is for the team " Norfolk Good" in the NEON Terrestrial forecasting
challenge.

By setting some initial parameters, this notebook will download the latest 
NOAA forecasts for the four sites and turn them into inputs for the CABLE land
model.

First, set the global parameters:
 - forecast_date: the date for which we will take the forecast data
 - sites: the sites we want to forecast
```{r, Set parameters}
rm(list=ls())
forecast_date = as.Date("2021-01-01")
sites = c("BART","KONZ","OSBS","SRER")
```


```{r, Initial Setup}
knitr::opts_chunk$set(engine.opts = list(bash = "-l"))
library(reticulate)
use_python("/usr/local/bin/python3")
```

Here, we load the function provided by NEON that downloads the NOAA data

```{r}
source("workflows/NOAAdownload.R")
for (site in sites){
  download_noaa_files_s3(siteID = site, date = forecast_date, cycle = "00", local_directory <- "data")
}
```

Now we apply a function which takes each netCDF file from the 30 ensemble members
for each site and turns it into a CSV file:

```{r}
source("workflows/NOAA_to_CSV.R")
for (site in sites){
  NOAA_to_CSV(siteID = site, date = forecast_date)
}
```




```{python}
print("Hello World!")
```


```{bash}
ls | head -n 5
```


```{r}
```

